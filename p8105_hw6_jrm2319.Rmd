---
title: "Homework 6: Linear Models" 
output: github_document
Name: Jasmin Martinez
Date: 12/1/24
---

## Problem 2 
```{r}
library(rvest)
library(tidyverse)

url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"
homicides_data = read_csv(url)
head(homicides_data)
```

### Part A: Create a city_state variable (e.g. “Baltimore, MD”), and a binary variable indicating whether the homicide is solved

```{r}
homicides_data = homicides_data %>%
  mutate(city_state = str_c(city, ", ", state)) 

homicides_data = homicides_data %>%
  mutate(solved_homicides = ifelse(disposition == "Closed by arrest", 1, 0))

homicides_data = homicides_data %>%
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")))

homicides_data = homicides_data %>%
  filter(victim_race %in% c("White", "Black"))

homicides_data = homicides_data %>%
  mutate(victim_age = as.numeric(ifelse(victim_age == "unknown", NA, victim_age)))

head(homicides_data)
```

### Part B: For the city of Baltimore, MD, use the glm function to fit a logistic regression with resolved vs unresolved as the outcome and victim age, sex and race as predictors

```{r}
bmore_data = homicides_data %>%
  filter(city_state == "Baltimore, MD") %>%
  filter(!is.na(solved_homicides), !is.na(victim_age), !is.na(victim_sex), !is.na(victim_race))

fit_logistic = bmore_data |> 
  glm(solved_homicides ~ victim_age + victim_sex + victim_race, data = _, family = binomial()) 

fit_logistic |> 
  broom::tidy(conf.int = TRUE) |> 
  mutate(OR = exp(estimate)) |>
  select(term, log_OR = estimate, OR, conf.low, conf.high, p.value) |> 
  knitr::kable(digits = 3)
```

### Part C: Run glm for each of the cities in your dataset, and extract the adjusted odds ratio (and CI) for solving homicides comparing male victims to female victims.
```{r}
city_results = homicides_data %>%
  filter(!is.na(solved_homicides), !is.na(victim_sex), !is.na(victim_race)) %>%
  group_by(city_state) %>%
  nest() %>%
  mutate(
    model = map(data, ~ glm(solved_homicides ~  victim_sex, 
                            data = .x, family = binomial())),
    results = map(model, ~ broom::tidy(.x, conf.int = TRUE))
  ) %>%
  unnest(results) %>% 
  mutate(
    OR = exp(estimate), 
    log_OR = estimate   
  ) %>% 
   filter(
    term != "(Intercept)",        
    term != "victim_sexUnknown"     
  ) %>%
  select(city_state, term, log_OR, OR, conf.low, conf.high, p.value) # Select relevant columns
city_results %>%
  knitr::kable(digits = 3)
```

### Part D: Create a plot that shows the estimated ORs and CIs for each city. Organize cities according to estimated OR, and comment on the plot. 

## Problem 3

### Part A: Load and clean the data for regression analysis (i.e. convert numeric to factor where appropriate, check for missing data, etc.).

### Part B: Propose a regression model for birthweight.

#### Part B.2: Describe your modeling process and show a plot of model residuals against fitted values – use add_predictions and add_residuals in making this plot.

### Part C: Compare your model to two others

#### Part C.2: One using length at birth and gestational age as predictors (main effects only)

#### Part C.3: One using head circumference, length, sex, and all interactions (including the three-way interaction) between these
